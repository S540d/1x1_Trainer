# Custom ESLint Rules für Cross-Platform Safety

## Zukünftige Implementierung

Diese Datei dokumentiert **geplante** Custom ESLint Rules. Die Implementierung erfordert ein eigenes ESLint Plugin.

### Installation (Geplant)

```bash
npm install --save-dev eslint-plugin-react-native-platform-check
```

### Custom Rules (Konzept)

#### 1. `react-native-platform-check/no-unsafe-web-api`

Verhindert Verwendung von Web APIs ohne Platform.OS Check.

**Verboten:**
```typescript
// ❌ ERROR
const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

// ❌ ERROR
localStorage.setItem('key', 'value');

// ❌ ERROR
document.querySelector('.element');
```

**Erlaubt:**
```typescript
// ✅ OK
if (Platform.OS === 'web') {
  const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
}

// ✅ OK - mit platform-safe Kommentar
const value = window.innerWidth; // platform-safe: read-only property

// ✅ OK - in utils/platform.ts (whitelisted file)
export function safeWebAPI() {
  if (Platform.OS === 'web') {
    return window.matchMedia(...);
  }
}
```

**Konfiguration:**
```javascript
{
  "rules": {
    "react-native-platform-check/no-unsafe-web-api": ["error", {
      "apis": [
        "window.matchMedia",
        "window.localStorage",
        "window.sessionStorage",
        "document.*",
        "navigator.geolocation"
      ],
      "allowedFiles": ["utils/platform.ts"],
      "allowComments": ["platform-safe"]
    }]
  }
}
```

#### 2. `react-native-platform-check/prefer-asyncstorage`

Warnt bei localStorage Verwendung, empfiehlt AsyncStorage.

**Warnung:**
```typescript
// ⚠️ WARNING: Use AsyncStorage instead for cross-platform compatibility
if (Platform.OS === 'web') {
  localStorage.setItem('key', 'value');
}
```

**Vorschlag:**
```typescript
// ✅ Better
import { Storage } from './utils/platform';
await Storage.setItem('key', 'value');
```

#### 3. `react-native-platform-check/no-direct-window-access`

Verhindert direkte window.* Zugriffe außerhalb von Platform Checks.

**Konfiguration:**
```javascript
{
  "rules": {
    "react-native-platform-check/no-direct-window-access": ["error", {
      "allowReadOnly": true,  // erlaubt window.innerWidth, etc.
      "allowList": ["window.addEventListener"]
    }]
  }
}
```

## Workaround bis zur Plugin-Implementierung

Verwende das Validierungsskript:

```bash
./scripts/validate-release.sh
```

Oder Pre-Commit Hook (automatisch bei Git Commit).

## Implementation Plan

### Phase 1: Regex-basierte Checks (✅ Implementiert)
- Bash Scripts in CI/CD
- Pre-commit hooks
- Einfach zu warten, keine Dependencies

### Phase 2: ESLint Plugin (Geplant)
- Erstelle `eslint-plugin-react-native-platform-check`
- AST-basierte Analyse
- Auto-fix Capabilities
- IDE Integration

### Phase 3: TypeScript Compiler Check (Zukunft)
- Custom TypeScript Transformer
- Compile-time Errors
- Vollständige Type Safety

## Ressourcen

- [ESLint Custom Rules Guide](https://eslint.org/docs/latest/extend/custom-rules)
- [AST Explorer](https://astexplorer.net/)
- [React Native Platform Specific Code](https://reactnative.dev/docs/platform-specific-code)
